/**
 * @(#)Des.java
 *
 *
 * @Murtaza
 * @version 1.00 2013/8/24
 */

import java.io.*;

public class Des {
	private static final int[] P = {
        16, 7,  20, 21,
        29, 12, 28, 17,
        1,  15, 23, 26,
        5,  18, 31, 10,
        2,  8,  24, 14,
        32, 27, 3,  9,
        19, 13, 30, 6,
        22, 11, 4,  25
    };
	public static final byte[][] S = { {
        14, 4,  13, 1,  2,  15, 11, 8,  3,  10, 6,  12, 5,  9,  0,  7},
        {0,  15, 7,  4,  14, 2,  13, 1,  10, 6,  12, 11, 9,  5,  3,  8},
        {4,  1,  14, 8,  13, 6,  2,  11, 15, 12, 9,  7,  3,  10, 5,  0},
        {15, 12, 8,  2,  4,  9,  1,  7,  5,  11, 3,  14, 10, 0,  6,  13}};
    public static void main(String[] args)throws Exception {

        BufferedReader br=new BufferedReader(new FileReader("pt.txt"));
        BufferedReader b1=new BufferedReader(new FileReader("key.txt"));
        String s=br.readLine();
        String fin="";
        long key=Long.parseLong(b1.readLine(),2);
        for(int k=0;k<16;k++){
        	fin="";
        StringBuilder exp=new StringBuilder(s.substring(32,s.length()));
        String output=exp.toString();
        exp.ensureCapacity(48);
        exp.insert(0,s.charAt(31));
        for(int i=4,j=5;i<32;i+=4,j+=6)
        {
        	exp.insert(j,s.charAt(i));
        	exp.insert(j+1,s.charAt(i-1));
        }
        exp.insert(47,s.charAt(0));
        System.out.println("Expansion :"+exp);
        long right=Long.parseLong(exp.toString(),2);
        System.out.println("After Ex-OR:"+Long.toBinaryString(key^right));
        String fexp=String.format("%48s",Long.toBinaryString(key^right)).replace(' ','0');

        for(int i=0;i<48;i+=6)
        {
        	String n=fexp.substring(i,i+6);
        	String n1=n.substring(0,1)+n.substring(5,6);
        	String n2=n.substring(1,5);
        	int a=Integer.parseInt(n1,2);
        	int b=Integer.parseInt(n2,2);
        	byte res=S[a][b];
            String s1 = String.format("%4s", Integer.toBinaryString(res & 0xFF)).replace(' ', '0');
            fin=fin+s1;
        }
        System.out.println("After S-box:"+fin);
        char sob[]=new char[32];
        for(int i=0;i<32;i++)
        {
        	sob[P[i]-1]=fin.charAt(i);
        }
        String po=new String(sob);
        System.out.println("After P-box:"+po);
        long left=Long.parseLong(s.substring(0,32),2)^Long.parseLong(po,2);
        System.out.println("Left is:"+Long.toBinaryString(left));
        System.out.println("After swapping");
        output=output+String.format("%32s",Long.toBinaryString(left)).replace(' ','0');
        System.out.println("For round"+(k+1)+"the output is:"+output);
        s=output;
        }
    }
}

/*Output:
Expansion :010101010101010101010101010101010101010101010101
After Ex-OR:101010101010101010101010101010101010101010101010
After S-box:01100110011001100110011001100110
After P-box:00110011001110100101001100110110
Left is:10011001100100001111100110011100
After swapping
For round1the output is:1010101010101010101010101010101010011001100100001111100110011100
Expansion :010011010011010011000001011111010011010011011001
After Ex-OR:101100101100101100111110100000101100101100100110
After S-box:00100010001000000100001000101000
After P-box:00100001000000000001011000010100
Left is:10001011101010101011110010111110
After swapping
For round2the output is:1001100110010000111110011001110010001011101010101011110010111110
Expansion :010001110111110100110101010111111001110111111101
After Ex-OR:101110001000001011001010101000000110001000000010
After S-box:10110010001011111101000100100100
After P-box:01001001111001010101101000010110
Left is:11010000011101011010001110001010
After swapping
For round3the output is:1000101110101010101111001011111011010000011101011010001110001010
Expansion :011011000001101111001011010101100111010001110101
After Ex-OR:100100111110010000110100101010011000101110001010
After S-box:11100000001110010110010110111111
After P-box:00011111111000010011011111100100
Left is:10010100010010111000101101011010
After swapping
For round4the output is:1101000001110101101000111000101010010100010010111000101101011010
Expansion :010010101000001000110111110000010111101011010101
After Ex-OR:101101010111110111001000001111101000010100101010
After S-box:00011011111000100001110101100110
After P-box:10010000101011101000101000111111
Left is:1000000110110110010100110110101
After swapping
For round5the output is:1001010001001011100010110101101001000000110110110010100110110101
Expansion :001000100000011011010111100101010010110111101011
After Ex-OR:110111011111100100101000011010101101001000010100
After S-box:11101000111011011001000100100110
After P-box:11011010111001110101001000001100
Left is:1001110101011001101100101010110
After swapping
For round6the output is:0100000011011011001010011011010101001110101011001101100101010110
Expansion :101000011101010101111000111011010011101010101100
After Ex-OR:10111100010101010000111000100101100010101010011
After S-box:10110001011001001101001011000110
After P-box:01110001001011111111101000000000
Left is:110001111101001101001110110101
After swapping
For round7the output is:0100111010101100110110010101011000110001111101001101001110110101
Expansion :000111000011011111001001011011100110110110101010
After Ex-OR:111000111100100000110110100100011001001001010101
After S-box:00110101010001111110100111101100
After P-box:01000001111110101111110100000111
Left is:1111010101100010010001010001
After swapping
For round8the output is:0011000111110100110100111011010100001111010101100010010001010001
Expansion :100000111111101010101101000100101001101010100010
After Ex-OR:11111000000010101010010111011010110010101011101
After S-box:10001110110010100000110011000011
After P-box:10011000000110110010000010111011
Left is:10101001111011111111001100001110
After swapping
For round9the output is:0000111101010110001001000101000110101001111011111111001100001110
Expansion :110101010010111100111110011110000110000000111100
After Ex-OR:1010101101000011000001100001111001111111000011
After S-box:11110001111100001111101011011111
After P-box:11110111001011111011111111000001
Left is:11111000011110011001101110010000
After swapping
For round10the output is:1010100111101111111100110000111011111000011110011001101110010000
Expansion :011111010001101111010011110010110110110011000001
After Ex-OR:100000101110010000101100001101001001001100111110
After S-box:01001011001100101101111010110000
After P-box:01100111000001001010001001111111
Left is:11001110111010110101000101110001
After swapping
For round11the output is:1111100001111001100110111001000011001110111010110101000101110001
Expansion :011001111100011101110111101011100011101110100011
After Ex-OR:100110000011100010001000010100011100010001011100
After S-box:10001111000100100110000010100000
After P-box:00000001000100011010000101011110
Left is:11111001011010000011101011001110
After swapping
For round12the output is:1100111011101011010100010111000111111001011010000011101011001110
Expansion :111111010011001101010000100110110100111000111101
After Ex-OR:101100110010101111011001001011000111000010
After S-box:11100010110001111001001001000100
After P-box:11100010011011110101000000010010
Left is:101100100001000000000101100011
After swapping
For round13the output is:1111100101101000001110101100111000101100100001000000000101100011
Expansion :000101111000110001001000000001100011001101000111
After Ex-OR:111010000111001110110111111110011100110010111000
After S-box:10100100100011100000000011000011
After P-box:10011000000110010111000010000010
Left is:1100001011100010100101001001100
After swapping
For round14the output is:0010110010000100000000010110001101100001011100010100101001001100
Expansion :101101000011001110000010001000010100101000011000
After Ex-OR:10010111100110001111101110111101011010111100111
After S-box:10100101010101101110100110110010
After P-box:01010101100100111111000101000111
Left is:1111001000101111111000000100100
After swapping
For round15the output is:0110000101110001010010100100110001111001000101111111000000100100
Expansion :001110010010100010101110111111000000000101001000
After Ex-OR:110001101101011101010001000000111111111010110111
After S-box:01010001001110101110110110101110
After P-box:01011011101000001010111101100111
Left is:111010110100011110010100101011
After swapping
For round16the output is:0111100100010111111100000010010000111010110100011110010100101011

Process completed.

